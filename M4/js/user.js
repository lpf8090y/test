!function(window,$){var wapReg=window.wapReg={};wapReg.getURL=function(){var e=window.location.href,o="?",r=e.split("?")[1];return void 0==r||""==r?o="":o+=r,o},wapReg.regFun=function(){var e=this,o=$("#referer").val(),r=$("#sendRedirect").val();$("#toProtocol").click(function(o){o.preventDefault(),window.location.href=B5M_UC.rootPath+"/protocol"+e.getURL()});var t=$("#register-form");t.submit(function(){return!1}),jQuery.validator.addMethod("isAccount",function(o){return e.isMobile(o)?e.isMobileUse(o)?!0:(this.settings.messages.mobile.isAccount="手机号已经被占用，请更换手机号",!1):(this.settings.messages.mobile.isAccount="请输入正确的手机号",!1)},jQuery.validator.format("{0}")),jQuery.validator.addMethod("codeLength",function(o){return e.codeLength(o)?!0:!1},"验证码为6位数字"),jQuery.validator.addMethod("isPasswordOk",function(e){return/^[a-zA-Z_0-9]{6,15}$/.test(e)},"请输入正确格式的字母，数字"),t.validate({rules:{mobile:{required:!0,isAccount:!0},code:{required:!0,codeLength:!0},password:{required:!0,rangelength:[6,15],isPasswordOk:!0}},messages:{mobile:{required:"手机号不能为空"},code:{required:"验证码不能为空"},password:{required:"密码不能为空",rangelength:"密码长度需{0}至{1}位"}},errorElement:"span",errorClass:"reg-error",errorPlacement:function(e){$.trim(e.html()).length<=0||($("#server").hide().empty(),$(".reg-error-box").empty().show().html(e.html()))},success:function(){$(".reg-error-box").hide().empty()},onkeyup:!1}),$("#getCode").click(function(){return $.trim($("#mobile").val()).length<1?!1:void(t.valid()&&e.getCode())}),$("#registerBtn").click(function(){if(t.valid()){if(!$("#protocol").prop("checked"))return b5mwap.ui.msgDialog({content:'<div class="dialog-reg">请接受服务条款</div>',isOpen:!0,btn:{"确定":function(){$("#protocol").prop("checked",!0),this.close()},"取消":function(){this.close()}}}),!1;e.loadingBox("open"),$.getJSON(B5M_UC.rootPath+"/register",t.serializeArray(),function(t){if(console.log(t),t.ok){"1"===$("#is_app").val()&&B5MApp.appMethod({method:"loginSuccess",callbackId:"0"});{var n=t.data;n.indexOf(";"),new Date((new Date).getTime()+108e5)}window.location.href=r.length?r:o.length?o:B5M_UC.rootPath+"/index"+e.getURL()}else e.loadingBox("close"),$(".reg-error-box").empty().show().html(t.data)})}})},wapReg.loginFun=function(){var e=this,o=$("#referer").val(),r=$("#sendRedirect").val();$("#toForget").click(function(o){o.preventDefault(),window.location.href="findpwd.html"}),$("#regLink").click(function(o){o.preventDefault(),window.location.href="reg.html"}),$("#directBuy").click(function(o){o.preventDefault(),window.location.href="#"});var t=$("#login-form");t.submit(function(){return!1}),jQuery.validator.addMethod("isAccount",function(o){return e.isMobile(o)||e.isEmail(o)?!0:(this.settings.messages.userName.isAccount="请输入正确的邮箱/手机",!1)},jQuery.validator.format("{0}")),t.validate({rules:{userName:{required:!0,isAccount:!0},password:{required:!0,rangelength:[6,15]}},messages:{userName:{required:"邮箱/手机不能为空"},password:{required:"密码不能为空",rangelength:"密码长度需{0}至{1}位"}},errorElement:"span",errorClass:"error",errorPlacement:function(e,o){if(!($.trim(e.html()).length<=0)){$("#server").hide().empty();{$(o).parents(".field")}$(".reg-error-box").empty().show().html(e.html())}},success:function(){$(".reg-error-box").hide().empty()},onkeyup:!1}),$("#loginBtn").click(function(){t.valid()&&(e.loadingBox("open"),$.getJSON(B5M_UC.rootPath+"/login?jsonpCallback=?",t.serializeArray(),function(t){if(t.ok){var n=$(".xiaobangbang-left-wrap");if(n.length>0)return $("#is_login").val("1"),n.find(".loginWrap").remove(),n.children().show(),void b5mXBB.show();"1"===$("#is_app").val()&&B5MApp.appMethod({method:"loginSuccess",callbackId:"0"});{var i=t.data;i.indexOf(";"),new Date((new Date).getTime()+108e5)}window.location.href=r.length?r:o.length&&o.indexOf("findpassword.html")<0?o:B5M_UC.rootPath+"/index"+wapReg.getURL()}else e.loadingBox("close"),$(".reg-error-box").empty().show().html(t.data)}))})},wapReg.findFun=function(){var e=this,o=$("#find-form");o.submit(function(){return!1}),jQuery.validator.addMethod("isAccount",function(o){return e.isMobile(o)?!0:(this.settings.messages.mobile.isAccount="请输入正确的手机号",!1)},jQuery.validator.format("{0}")),jQuery.validator.addMethod("codeLength",function(o){return e.codeLength(o)?!0:!1},"验证码为6位数字"),jQuery.validator.addMethod("isPasswordOk",function(e){return/^[a-zA-Z_0-9]{6,15}$/.test(e)},"请输入正确格式的字母，数字"),o.validate({rules:{mobile:{required:!0,isAccount:!0},code:{required:!0,codeLength:!0},newPassword:{required:!0,rangelength:[6,15],isPasswordOk:!0},confirmPassword:{required:!0,rangelength:[6,15],isPasswordOk:!0,equalTo:"#password"}},messages:{mobile:{required:"手机号不能为空"},code:{required:"验证码不能为空"},newPassword:{required:"密码不能为空",rangelength:"密码长度需{0}至{1}位"},confirmPassword:{required:"密码不能为空",rangelength:"密码长度需{0}至{1}位",equalTo:"两次输入的密码不一致"}},errorElement:"span",errorClass:"reg-error",errorPlacement:function(e){$.trim(e.html()).length<=0||($("#server").hide().empty(),$(".reg-error-box").empty().show().html(e.html()))},success:function(){$(".reg-error-box").hide().empty()},onkeyup:!1}),$("#getCode").click(function(){return $.trim($("#mobile").val()).length<1?!1:void(o.valid()&&e.getCode())}),$("#findBtn").click(function(){o.valid()&&(e.loadingBox("open"),$.getJSON(B5M_UC.rootPath+"/findpassword",o.serializeArray(),function(o){o.ok?window.location.href=B5M_UC.rootPath+"/login"+wapReg.getURL():(e.loadingBox("close"),$("#server").empty().show().html(o.data))}))})},wapReg.isMobile=function(e){return/^(13[0-9]|15[012356789]|17[0678]|18[0-9]|14[57])[0-9]{8}$/.test(e)},wapReg.isEmail=function(e){return/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]{2,})+$/.test(e)},wapReg.isMobileUse=function(value){var code=0;return $.ajax({type:"post",data:"mobile="+value,async:!1,dataType:"json",url:B5M_UC.rootPath+"/isMobileUse",success:function(r){code=eval(r).code}}),1===code?!0:!1},wapReg.codeLength=function(e){return/^[0-9]{6}$/.test(e)},wapReg.getCode=function(){var e=60,o=B5M_UC.rootPath+"/getMobileCode",r=null,t=$("#getCode");$("#code").removeClass("reg-disabled").prop("disabled",!1).focus(),$(".icon-reg-psw").removeClass("reg-disabled").prop("disabled",!1);var n=setInterval(function(){return 0>=e?(t.val("重新获取验证码").prop("disabled",!1),void clearInterval(n)):void t.val(--e+"秒后重新获取")},1e3);t.hasClass("get-code-register")?r=1:t.hasClass("get-code-find")&&(r=2),$.ajax({type:"post",data:{mobile:$("#mobile").val(),type:r},async:!1,dataType:"jsonp",jsonp:"jsonpCallback",url:o,success:function(e){console.log(e),0==e.ok}})},wapReg.inputHandler=function(){$(".reg-input").each(function(){var e=$(this),o=e.parent().find(".reg-empty");e.on("keyup",function(){var r=$.trim(e.val());r.length?(o.show(),o.click(function(o){o.preventDefault(),e.val(""),$(this).hide()})):o.hide()})})},wapReg.loadingBox=function(e){if(!$("#ajaxLoadBox").length){var o='<div id="ajaxLoadBox" class="loadBox"><a href="javascript:void(0);"></a></div>';$("body").append(o)}"open"==e&&$("#ajaxLoadBox").show(),"close"==e&&$("#ajaxLoadBox").hide()}}(window,jQuery);var WapCommJs=window.WapCommJs||{};WapCommJs.url_get_data=function(){var e=window.document.location.href.toString();e=e.replace(/(\#[\w\.]*$)/g,"");var o=e.split("?");if("string"==typeof o[1]){o=o[1].split("&");var r={};for(var t in o){var n=o[t].split("=");r[n[0]]=n[1]}return r}return{}},WapCommJs.getCookieValue=function(e){var o=document.cookie,r=o.indexOf(""+e+"=");return-1==r&&(r=o.indexOf(e+"=")),-1==r?o=null:(r=o.indexOf("=",r)+1,cookieEndAt=o.indexOf(";",r),-1==cookieEndAt&&(cookieEndAt=o.length),o=unescape(o.substring(r,cookieEndAt))),o};